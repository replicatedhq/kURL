- name: "Cust sha1:a272ff47a5d0163c65b97c2d2c5acfbc0396f2c4: k8s 1.21->1.26, openebs 3.3 -> 3.8.0, weave->flannel, docker->containerd"
  flags: "yes"
  numSecondaryNodes: 2
  installerApiEndpoint: https://kurl.sh
  installerSpec:
    kubernetes:
      version: 1.21.14
    docker:
      daemonConfig: |
        {
          "exec-opts": ["native.cgroupdriver=systemd"],
          "log-opts": {
            "max-size": "100m",
            "max-file": "3"
          }
        }
      version: 19.03.10
    weave:
      version: 2.6.5-20221025
    openebs:
      isCstorEnabled: false
      isLocalPVEnabled: true
      localPVStorageClassName: openebs
      namespace: openebs
      version: 3.3.0
    minio:
      version: 2022-10-20T00-55-09Z
    contour:
      tlsMinimumProtocolVersion: '1.2'
      version: 1.23.0
    registry:
      version: 2.8.1
    kotsadm:
      applicationSlug: a-test-app
      version: 1.90.0
      s3Override: https://s3.kurl.sh/external/kotsadm-1.90.0.tar.gz
    velero:
      resticTimeout: 24h0m0s
      version: 1.9.2
    ekco:
      minReadyMasterNodeCount: 2
      minReadyWorkerNodeCount: 0
      nodeUnreachableToleration: 5m
      shouldDisableClearNodes: false
      shouldDisableRebootServices: false
      shouldEnablePurgeNodes: false
      version: 0.25.0
    kurl:
      installerVersion: v2023.03.28-0
      additionalNoProxyAddresses: [ ]
    goldpinger:
      version: 3.7.0-5.5.0
  upgradeSpec:
    kubernetes:
      version: 1.26.6
    flannel:
      version: "__testver__"
      s3Override: "__testdist__"
    openebs:
      isLocalPVEnabled: true
      localPVStorageClassName: openebs
      namespace: openebs
      version: 3.8.0
    minio:
      version: 2023-09-04T19-57-37Z
    contour:
      tlsMinimumProtocolVersion: '1.2'
      version: 1.25.0
    registry:
      version: 2.8.2
    kotsadm:
      applicationSlug: a-test-app
      version: 1.102.0
      s3Override: https://s3.kurl.sh/external/kotsadm-1.102.0.tar.gz
    velero:
      resticTimeout: 24h0m0s
      version: 1.11.0
    ekco:
      minReadyMasterNodeCount: 2
      minReadyWorkerNodeCount: 0
      nodeUnreachableToleration: 5m
      shouldDisableClearNodes: false
      shouldDisableRebootServices: false
      shouldEnablePurgeNodes: false
      version: 0.28.3
    containerd:
      version: 1.6.21
    goldpinger:
      version: 3.7.0-6.0.1
  unsupportedOSIDs:
    - ubuntu-2204 # this version of docker is too old for 22.04
    - rocky-92
    - ol-8x
  postInstallScript: |
    # source helper functions
    source /opt/kurl-testgrid/testhelpers.sh

    # deploy sample app
    install_and_customize_kurl_integration_test_application
  postUpgradeScript: |
    # source helper functions
    source /opt/kurl-testgrid/testhelpers.sh

    # ensure we can redeploy sample app
    check_and_customize_kurl_integration_test_application

    # ensure kubernetes was upgraded
    if [[ ! "$(kubectl get nodes --sort-by='{.status.nodeInfo.kubeletVersion}' -o=jsonpath='{.items[0].status.nodeInfo.kubeletVersion}' | sed 's/^v*//')" =~ "1.26" ]]; then
      echo "Kubernetes was not upgraded to 1.26.x"
      exit 1
    fi
