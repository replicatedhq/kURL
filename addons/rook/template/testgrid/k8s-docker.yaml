- name: Rook minimal
  installerSpec:
    kubernetes:
      version: "latest"
    weave:
      version: "latest"
    containerd:
      version: "latest"
    minio:
      version: "latest"
    kotsadm:
      version: "latest"
    ekco:
      version: "latest"
    rook:
      version: "__testver__"
      s3Override: "__testdist__"
      isBlockStorageEnabled: true
  unsupportedOSIDs:
    - centos-74 # Rook > 1.7 not supported on 3.10 kernel
  postInstallScript: |
    source /opt/kurl-testgrid/testhelpers.sh
    rook_ecph_object_store_info
    validate_read_write_object_store rwtest testfile.txt

    minio_object_store_info
    validate_read_write_object_store rwtest minio.txt

- name: Upgrade from 1.7.11
  installerSpec:
    kubernetes:
      version: "latest"
    weave:
      version: "latest"
    containerd:
      version: "latest"
    minio:
      version: "latest"
    kotsadm:
      version: "latest"
    ekco:
      version: "latest"
    rook:
      version: "1.7.11"
      isBlockStorageEnabled: true
  upgradeSpec:
    kubernetes:
      version: "latest"
    weave:
      version: "latest"
    containerd:
      version: "latest"
    minio:
      version: "latest"
    kotsadm:
      version: "latest"
    ekco:
      version: "latest"
    rook:
      version: "__testver__"
      s3Override: "__testdist__"
      isBlockStorageEnabled: true
      bypassUpgradeWarning: true
  unsupportedOSIDs:
    - centos-74 # Rook > 1.7 not supported on 3.10 kernel
  postInstallScript: |
    source /opt/kurl-testgrid/testhelpers.sh
    rook_ecph_object_store_info
    validate_read_write_object_store rwtest testfile.txt

    minio_object_store_info
    validate_read_write_object_store rwtest minio.txt
  postUpgradeScript: |
    source /opt/kurl-testgrid/testhelpers.sh

    operatorVersion=$(kubectl get deployment -n rook-ceph rook-ceph-operator -o jsonpath='{.spec.template.spec.containers[0].image}')
    echo $operatorVersion | grep __testver__

    rook_ecph_object_store_info
    validate_testfile rwtest testfile.txt
    validate_read_write_object_store postupgrade upgradefile.txt

    minio_object_store_info
    validate_testfile rwtest minio.txt
    validate_read_write_object_store postupgrade minioupgrade.txt

- name: Disable shared filesystem
  installerSpec:
    kubernetes:
      version: "latest"
    weave:
      version: "latest"
    containerd:
      version: "latest"
    minio:
      version: "latest"
    kotsadm:
      version: "latest"
    ekco:
      version: "latest"
    rook:
      version: "__testver__"
      s3Override: "__testdist__"
      isSharedFilesystemDisabled: true
      isBlockStorageEnabled: true
  unsupportedOSIDs:
    - centos-74 # Rook > 1.7 not supported on 3.10 kernel
  postInstallScript: |
    source /opt/kurl-testgrid/testhelpers.sh
    rook_ecph_object_store_info
    validate_read_write_object_store rwtest testfile.txt

    minio_object_store_info
    validate_read_write_object_store rwtest minio.txt
